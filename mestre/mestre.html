<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Papoque-os</title>
    <link rel="stylesheet" href="../style.css">
</head>
<body>
    <script>
        const user = localStorage.getItem("logado");

        if (user !== "mestre") {
            window.location.href = "../index.html";
        }

    </script>
    <div class="cabecinha">
        <h1>Bem-vindo, Mestre!</h1>
        <p>Aqui estão os links para as fichas dos jogadores:</p>
    <a href="../players/p1.html">Ficha Apolo(Ravir)</a>
<a href="../players/p2.html">Ficha Laugh(Ruan)</a>
<a href="../players/p3.html">Ficha (Luma)</a>
<a href="../players/p4.html">Ficha  Claymant(Cayo)</a>
<a href="../players/p5.html">Ficha Stella(Juliana)</a>
    </div>
    <h2>Histórico de Rolagens</h2>
<div id="historico"></div>

    <script type="module">
import { db } from "../firebase.js";
import { ref, onValue } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

const historicoDiv = document.getElementById("historico");

const historicoRef = ref(db, "historicoDados");

onValue(historicoRef, snapshot => {
  historicoDiv.innerHTML = "";

  const dados = snapshot.val();
  if (!dados) return;

  const lista = Object.values(dados)
    .sort((a, b) => b.timestamp - a.timestamp)
    .slice(0, 50); // últimos 50

  lista.forEach(item => {
    const div = document.createElement("div");
    div.className = "log";

    const data = new Date(item.timestamp).toLocaleString("pt-BR");

    div.innerHTML = `
      <strong>${item.jogador}</strong>
      rolou <em>${item.pericia}</em>
      (${item.valorSkill})
      → <strong>${item.resultado}</strong>
      [d20: ${item.dado}]
      <span style="opacity:.6">(${data})</span>
    `;

    historicoDiv.appendChild(div);
  });
});
</script>

</body>
</html>
