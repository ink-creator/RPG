<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Papoque-os — Mestre</title>
  <link rel="stylesheet" href="../style.css">
</head>
<body>

<script>
  const user = localStorage.getItem("logado");
  if (user !== "mestre") {
    window.location.href = "../index.html";
  }
</script>

<div class="cabecinha">
  <h1>Bem-vindo, Mestre!</h1>

  <p>Fichas dos jogadores:</p>
  <a href="../players/p1.html">Ficha Apolo (Ravir)</a><br>
  <a href="../players/p2.html">Ficha Laugh (Ruan)</a><br>
  <a href="../players/p3.html">Ficha Luma</a><br>
  <a href="../players/p4.html">Ficha Claymant (Cayo)</a><br>
  <a href="../players/p5.html">Ficha Stella (Juliana)</a>
</div>
<h2>Histórico de Rolagens</h2>
<ul id="historico"></ul>

<script type="module">
import { db, ref, onValue } from "./firebase.js";

const HIST_LIST = document.getElementById("historico");

onValue(ref(db, "historico"), snapshot => {
  HIST_LIST.innerHTML = ""; // limpa lista
  if (!snapshot.exists()) return;

  const data = snapshot.val();
  for (const playerId in data) {
    const rolls = data[playerId];
    for (const key in rolls) {
      const item = rolls[key];
      const li = document.createElement("li");
      const dataStr = new Date(item.data).toLocaleString();
      li.textContent = `[${dataStr}] ${playerId}: ${item.nome} → ${item.resultado}`;
      HIST_LIST.appendChild(li);
    }
  }
});
</script>
</body>
</html>
