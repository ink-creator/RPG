<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Árvore de Habilidades</title>

<style>
body{
  margin:0;
  background:#0b0b12;
  font-family:Arial, sans-serif;
  overflow:hidden;
}

#toolbar{
  position:fixed;
  top:10px;
  left:10px;
  z-index:10;
}

#toolbar button{
  padding:10px 14px;
  background:#6a5acd;
  border:none;
  color:white;
  font-weight:bold;
  border-radius:8px;
  cursor:pointer;
}

#canvas{
  width:100vw;
  height:100vh;
  position:relative;
}

.node{
  position:absolute;
  display:flex;
  flex-direction:column;
  align-items:center;
  user-select:none;
  cursor:grab;
}

.bubble{
  width:90px;
  height:90px;
  border-radius:50%;
  background:#222;
  border:2px solid #aaa;
  display:flex;
  align-items:center;
  justify-content:center;
}

.node-title{
  margin-top:6px;
  font-size:12px;
  color:white;
}
</style>
</head>

<body>

<div id="toolbar">
  <button id="btnAdd">➕ Adicionar Bolha</button>
</div>

<div id="canvas"></div>

<script>
/* =========================
   ESTADO GLOBAL
========================= */
const canvas = document.getElementById("canvas");
const btnAdd = document.getElementById("btnAdd");

let nodes = [];
let loading = false;

/* =========================
   CRIAR BOLHA
========================= */
function addBubble(data = {}) {
  const node = document.createElement("div");
  node.className = "node";

  node.style.left = data.left || "200px";
  node.style.top  = data.top  || "200px";

  const bubble = document.createElement("div");
  bubble.className = "bubble";

  const title = document.createElement("div");
  title.className = "node-title";
  title.textContent = data.title || "Nova Skill";

  node.appendChild(bubble);
  node.appendChild(title);

  drag(node);
  canvas.appendChild(node);
  nodes.push(node);

  if (!loading) saveAll();
}

/* =========================
   DRAG
========================= */
function drag(el) {
  let ox, oy;

  el.addEventListener("mousedown", e => {
    ox = e.offsetX;
    oy = e.offsetY;

    function move(ev){
      el.style.left = (ev.pageX - ox) + "px";
      el.style.top  = (ev.pageY - oy) + "px";
    }

    function up(){
      document.removeEventListener("mousemove", move);
      document.removeEventListener("mouseup", up);
      saveAll();
    }

    document.addEventListener("mousemove", move);
    document.addEventListener("mouseup", up);
  });
}

/* =========================
   SAVE / LOAD (localStorage)
========================= */
function saveAll(){
  const data = nodes.map(n => ({
    left: n.style.left,
    top: n.style.top,
    title: n.querySelector(".node-title").textContent
  }));

  localStorage.setItem("skillTree", JSON.stringify(data));
}

function loadAll(){
  const raw = localStorage.getItem("skillTree");
  if (!raw) return;

  loading = true;
  const data = JSON.parse(raw);

  nodes.forEach(n => n.remove());
  nodes = [];

  data.forEach(d => addBubble(d));

  loading = false;
}

/* =========================
   EVENTOS
========================= */
btnAdd.addEventListener("click", () => {
  addBubble();
});

/* =========================
   INIT
========================= */
loadAll();
</script>

</body>
</html>
